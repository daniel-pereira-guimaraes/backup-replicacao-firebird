CREATE TABLE BancoDados(
	Id INTEGER GENERATED BY DEFAULT AS IDENTITY NOT NULL,
	Nome VARCHAR(50) NOT NULL,
	Maquina VARCHAR(50) NOT NULL,
	Porta INTEGER NOT NULL,
	Endereco VARCHAR(250) NOT NULL,
	Caracteres VARCHAR(20) NOT NULL,
	Usuario VARCHAR(50) NOT NULL,
	Senha VARCHAR(50) NOT NULL,
	CONSTRAINT PK_BancoDados PRIMARY KEY(Id),
	CONSTRAINT UN_BancoDados_Nome UNIQUE(Nome),
	CONSTRAINT UN_BancoDados UNIQUE(Maquina, Porta, Endereco)
);

CREATE TABLE Monitor(
	Id INTEGER GENERATED BY DEFAULT AS IDENTITY NOT NULL,
	Nome VARCHAR(50) NOT NULL,
	Chave VARCHAR(50) NOT NULL,
	Controle VARCHAR(32),
	CONSTRAINT PK_Monitor PRIMARY KEY(Id),
	CONSTRAINT UN_Monitor_Chave UNIQUE(Chave)
);

CREATE TABLE Pasta(
	Id INTEGER GENERATED BY DEFAULT AS IDENTITY NOT NULL,
	Nome VARCHAR(50) NOT NULL,
	Tipo SMALLINT NOT NULL,
	Endereco VARCHAR(250) NOT NULL,
	Maquina VARCHAR(50),
	Porta INTEGER,
	Usuario VARCHAR(50),
	Senha VARCHAR(50),
	CONSTRAINT PK_Pasta PRIMARY KEY(Id),
	CONSTRAINT UN_Pasta_Nome UNIQUE(Nome),
	CONSTRAINT UN_Pasta UNIQUE(Tipo, Maquina, Porta, Endereco)
);

CREATE TABLE Tarefa(
	Id INTEGER GENERATED BY DEFAULT AS IDENTITY NOT NULL,
	UUID VARCHAR(22) NOT NULL,
	Nome VARCHAR(50) NOT NULL,
	Tipo SMALLINT NOT NULL,
	BancoDados_Id INTEGER NOT NULL,
	Intervalo INTEGER NOT NULL,
	HoraInicial TIME NOT NULL,
	HoraFinal TIME NOT NULL,
	Domingo BOOLEAN NOT NULL,
	Segunda BOOLEAN NOT NULL,
	Terca BOOLEAN NOT NULL,
	Quarta BOOLEAN NOT NULL,
	Quinta BOOLEAN NOT NULL,
	Sexta BOOLEAN NOT NULL,
	Sabado BOOLEAN NOT NULL,
	Executada TIMESTAMP,
	CONSTRAINT PK_Tarefa PRIMARY KEY(Id),
	CONSTRAINT FK_Tarefa_BancoDados FOREIGN KEY(BancoDados_Id) REFERENCES BancoDados(Id),
	CONSTRAINT UN_Tarefa_Nome UNIQUE(Nome)
);
	
CREATE TABLE TarefaBackup(
	Id INTEGER GENERATED BY DEFAULT AS IDENTITY NOT NULL,
	Tarefa_Id INTEGER NOT NULL,
	Pasta_Id INTEGER NOT NULL,
	QtdManter SMALLINT NOT NULL,
	Estado SMALLINT NOT NULL,
	Mensagem VARCHAR(250),
	CONSTRAINT PK_TarefaBackup PRIMARY KEY(Id),
	CONSTRAINT UN_TarefaBackup UNIQUE(Tarefa_Id, Pasta_Id),
	CONSTRAINT FK_TarefaBackup_Tarefa FOREIGN KEY(Tarefa_Id) REFERENCES Tarefa(Id) ON DELETE CASCADE,
	CONSTRAINT FK_TarefaBackup_Pasta FOREIGN KEY(Pasta_Id) REFERENCES Pasta(Id)
);

CREATE TABLE TarefaReplicacao(
	Id INTEGER GENERATED BY DEFAULT AS IDENTITY NOT NULL,
	Tarefa_Id INTEGER NOT NULL,
	BancoDados_Id INTEGER NOT NULL,
	Estado SMALLINT NOT NULL,
	Mensagem VARCHAR(250),
	CONSTRAINT PK_TarefaReplicacao PRIMARY KEY(Id),
	CONSTRAINT UN_TarefaReplicacao UNIQUE(BancoDados_Id),
	CONSTRAINT FK_TarefaReplicacao_Tarefa FOREIGN KEY(Tarefa_Id) REFERENCES Tarefa(Id) ON DELETE CASCADE,
	CONSTRAINT FK_TarefaReplicacao_BancoDados FOREIGN KEY(BancoDados_Id) REFERENCES BancoDados(Id)
);

CREATE TABLE TarefaMonitor(
	Id INTEGER GENERATED BY DEFAULT AS IDENTITY NOT NULL,
	Tarefa_Id INTEGER NOT NULL,
	Monitor_Id INTEGER NOT NULL,
	CONSTRAINT PK_TarefaMonitor PRIMARY KEY(Id),
	CONSTRAINT UN_TarefaMonitor UNIQUE(Tarefa_Id, Monitor_Id),
	CONSTRAINT FK_TarefaMonitor_Tarefa FOREIGN KEY(Tarefa_Id) REFERENCES Tarefa(Id) ON DELETE CASCADE,
	CONSTRAINT FK_TarefaMonitor_Monitor FOREIGN KEY(Monitor_Id) REFERENCES Monitor(Id) ON DELETE CASCADE
);